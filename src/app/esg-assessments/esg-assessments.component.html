<div class="esg-page">

    <!--  Top Header  -->
    <header class="esg-header">
        <h2>üåø ESG Assessment Checklist</h2>
    </header>
<div class="progress-wrapper">
  <div class="progress-text">
    {{ answeredCount }} / {{ totalCount }} answered
  </div>

  <p-progressBar
    [value]="(answeredCount / totalCount) * 100"
    [showValue]="false"
    styleClass="green-progress">
  </p-progressBar>
</div>
<!-- ESG Summary - Visible only after submission -->
<div #summarySection class="esg-summary" *ngIf="summary">

  <div class="summary-header-bar">
    <h3>‚úÖ ESG Assessment Summary</h3>
    <p-chip [label]="summary.rating" [styleClass]="getRatingClass(summary.rating)"></p-chip>
  </div>

<div *ngIf="isReadOnly" class="locked-banner">
<i class="pi pi-lock"></i>
This ESG assessment has been submitted for appraisal and is now preview-only.
</div>

<div class="summary-overview">

  <!-- Average Score -->
  <div class="average-score-box">
    <span>Average Score</span>
    <h2>{{ summary.averageScore | number:'1.0-1' }}</h2>
    <p>{{ summary.rating }} Risk</p>

    <p-progressBar
      [value]="summary.averageScore"
      [showValue]="true"
      [styleClass]="'average-progress ' + getAverageScoreClass(summary.averageScore)">
    </p-progressBar>
  </div>

  <!-- Total Score & Weight -->
  <div class="average-score-box metrics-box">
    <div class="metric-col">
      <span><i class="pi pi-database"></i> Total Score</span>
      <h2>{{ summary.totalScore | number:'1.0-1' }}</h2>
    </div>

    <div class="metric-divider"></div>

    <div class="metric-col">
      <span><i class="pi pi-chart-line"></i> Total Weight</span>
      <h2>{{ summary.totalWeight | number:'1.0-1' }}</h2>
    </div>
  </div>

  <!-- Summary Comment -->
  <div class="summary-comment-card">
    <label for="summaryComment">
      <i class="pi pi-comment"></i>
      ESG Assessment Comment
    </label>

    <textarea
      id="summaryComment"
      pInputTextarea
      rows="4"
      [(ngModel)]="summary.comment"
      class="summary-textarea" disabled="true">
    </textarea>
  </div>

</div>

</div>

    <div class="esg-container" [class.read-only]="isReadOnly">

        <p-card *ngFor="let item of checklistItems" class="esg-card">

            <div class="esg-card-header">
                <h3>{{ item.item }}</h3>
                <span class="badge">{{ item.category }}</span>
            </div>

            <div class="esg-meta">
                <span class="meta-label">Indicator:</span>
                <span class="meta-value">{{ item.indicatorType }}</span>

                <span class="meta-label">Weight:</span>
                <span class="meta-value weight">{{ item.weight }}</span>
            </div>

            <div class="response-section">
                <label class="response-label">Select Response:</label>

                <p-selectButton 
                    [options]="item.responses"
                    optionLabel="label"
                    optionValue="responseValue"
                    [(ngModel)]="selectedResponses[item.checklistItemId]"
                    class="response-button"
                    (onChange)="onSelect(item.checklistItemId)"
                    [disabled]="isReadOnly">
                </p-selectButton>
            </div>

        </p-card>

    </div>
<!-- Mandatory ESG Comment -->
<div class="assessment-comment-card">
  <label for="assessmentComment">
    <i class="pi pi-comment"></i>
    ESG Assessment Comment <span class="required">*</span>
  </label>

  <textarea
    id="assessmentComment"
    pInputTextarea
    rows="4"
    [(ngModel)]="assessmentComment"
    placeholder="Provide justification, ESG considerations, and observations for this loan assessment..."
    class="assessment-textarea"
    [disabled]="isReadOnly">
  </textarea>
</div>

    <div class="incomplete-hint" *ngIf="!isAssessmentComplete()">
  ‚ö†Ô∏è Please complete all checklist items before submitting.
</div>

<!-- ‚úÖ SUBMIT BAR -->
<footer class="esg-submit-bar">

  <div class="submit-actions">
    <!-- Submit for Appraisal -->
    <button
      pButton
      label="Submit for Appraisal"
      icon="pi pi-send"
      class="p-button-outlined appraisal-btn"
      [disabled]="!isAssessmentComplete()"
      (click)="submitLoanApplicationForAppraisal()" *ngIf="!submittedForAppraisal">
    </button>

    <!-- Submit ESG Assessment -->
    <button
      pButton
      label="Submit ESG Assessment"
      icon="pi pi-check"
      class="p-button-success submit-btn"
      [disabled]="!isAssessmentComplete() || assessmentComment.trim().length < 10 || isReadOnly"
      (click)="confirmSubmit()">
    </button>
  </div>

</footer>

</div>
<p-confirmDialog
  header="Confirm ESG Submission"
  icon="pi pi-exclamation-triangle"
  acceptLabel="Yes, Submit"
  rejectLabel="Review Again"
  styleClass="esg-confirm-dialog">
</p-confirmDialog>


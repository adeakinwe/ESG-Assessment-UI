<div class="esg-page">

    <!--  Top Header  -->
    <header class="esg-header">
        <h2>üåø ESG Assessment Checklist</h2>
    </header>
<div class="progress-wrapper">
  <div class="progress-text">
    {{ answeredCount }} / {{ totalCount }} answered
  </div>

  <p-progressBar
    [value]="(answeredCount / totalCount) * 100"
    [showValue]="false"
    styleClass="green-progress">
  </p-progressBar>
</div>
<!-- ESG Summary - Visible only after submission -->
<div #summarySection class="esg-summary" *ngIf="summary">

  <div class="summary-header-bar">
    <h3>‚úÖ ESG Assessment Summary</h3>
    <p-chip [label]="summary.rating" [styleClass]="getRatingClass(summary.rating)"></p-chip>
  </div>

  <div class="summary-overview">
    <div class="average-score-box">
      <span>Average Score</span>
      <h2>{{ summary.averageScore | number:'1.0-1' }}</h2>
      <p>{{ summary.rating }} Risk</p>
      <p-progressBar
        [value]="summary.averageScore"
        [showValue]="true"
        styleClass="average-progress">
      </p-progressBar>
    </div>

    <div class="category-breakdown">
      <p-card *ngFor="let d of summary.details" class="summary-card">
        <h4>{{ d.category }}</h4>
        <p>Score: {{ d.score }}</p>
        <p>Weight: {{ d.weight }}</p>
        <p-progressBar [value]="(d.score*d.weight) / summary.weightedScore * 100" [showValue]="true"></p-progressBar>
      </p-card>
    </div>
  </div>

</div>

    <div class="esg-container">

        <p-card *ngFor="let item of checklistItems" class="esg-card">

            <div class="esg-card-header">
                <h3>{{ item.item }}</h3>
                <span class="badge">{{ item.category }}</span>
            </div>

            <div class="esg-meta">
                <span class="meta-label">Indicator:</span>
                <span class="meta-value">{{ item.indicatorType }}</span>

                <span class="meta-label">Weight:</span>
                <span class="meta-value weight">{{ item.weight }}</span>
            </div>

            <div class="response-section">
                <label class="response-label">Select Response:</label>

                <p-selectButton 
                    [options]="item.responses"
                    optionLabel="label"
                    optionValue="responseValue"
                    [(ngModel)]="selectedResponses[item.checklistItemId]"
                    class="response-button"
                    (onChange)="onSelect(item.checklistItemId)">
                </p-selectButton>
            </div>

        </p-card>

    </div>

    <div class="incomplete-hint" *ngIf="!isAssessmentComplete()">
  ‚ö†Ô∏è Please complete all checklist items before submitting.
</div>

    <!-- ‚úÖ SUBMIT BAR -->
    <footer class="esg-submit-bar">
        <button
            pButton
            label="Submit ESG Assessment"
            icon="pi pi-check"
            class="p-button-success submit-btn"
            [disabled]="!isAssessmentComplete()"
            (click)="confirmSubmit()">
        </button>
    </footer>

</div>
<p-confirmDialog
  header="Confirm ESG Submission"
  icon="pi pi-exclamation-triangle"
  acceptLabel="Yes, Submit"
  rejectLabel="Review Again"
  styleClass="esg-confirm-dialog">
</p-confirmDialog>

